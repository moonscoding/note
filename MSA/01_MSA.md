\#MSA

## 차례

- 1장
  - MSA 아키텍처가 애플리케이션(특히 클라우드 기반 애플리케이션)을 구축하는데 중요하고 적절한 접근방법인 이유
- 2장
  - 스프링 부트를 사용해서 첫 번째 REST 기반 MSA를 작성
  - 아키텍트와 애플리케이션 엔지니어, 데브옵스 엔지니어 관점에서 어떻게 바라볼것인지 설명
- 3장
  - `스프링 클라우드 컨피그`를 사용한 MSA의 구성을 관리하는 방법 소개
  - `스프링 클라우드 컨피그`는 단일 저장소에 구성 정보를 중앙 집중화하고 버전 관리하여 모든 서비스 인스턴스에 반복 가능하게 구성
- 4장
  - MSA 첫 번째 라우팅 패턴인 `서비스 디스커버리` 소개
  - `스프링 클라우드`와 `넥플릭스의 유레카`서비스를 통해 서비스를 사용하는 클라이언트에서 서비스 위치를 추상화하는 방법 학습
- 5장
  - 하나 이상의 MSA 인스턴스가 다운되거나 성능이 저하될 때 MSA 소비자를 보호하는 방법
  - 스프링 클라우드와 넥플릭스 히스트릭스 및 리본을 사용해 
    클라이언트 측 호출의 부하 분산과 회로 차단기 패턴, 폴백 패턴, 벌크헤드 패턴을 구현
- 6장
  - 두번째 MSA 라우팅 패턴인 `서비스 게이트웨이`를 다룸
  - 넥플릭스 주울(Zuul) 서버와 함께 스프링 클라우드를 사용하면 호출되는 모든 MSA에 대해 단일 진입점을 만들 수 있음
  - 주울 필터 API를 사용해서 서비스 게이트웨이를 통하는 모든 서비스를 대상으로 시행할 수 있는 정책 작성법을 설명
- 7장
  - 스프링 클라우드 시큐리티오 OAuth2를 사용해서 서비스 인증과 권한 부여를 구현하는 방법 다룸
  - OAuth2 서비스를 설정하는 기본 사항과 OAuth2 구현에서 JWT을 사용하는 방법을 다룸
- 8장
  - 스프링 클라우드 스트림과 아파치 카프카를 사용해서 마이크로서비스에 비동기 메시징을 도입하는 방법을 살펴봄
- 9장
  - 스프링 클라우드 스루스와 오픈집킨을 사용해서 로그 상관관계와 로그수집, 로그추적같은 공통 로킹 패턴을 구현
- 10장
  - 책의 토대가 되는 프로젝트
  - 작성한 서비스들을 아마존 ECS에 배포 
  - 빌드 및 배포 자동화 방법을 설명
- 부록A
  - 데스크톱 개발환경 설정
  - 로컬 빌드 프로세스의 작동방식과 도커
- 부록B
  - OAuth2에 대한 보충자료
  - OAuth2는 매우 유연한 인증 모델로 이 부록에서 애플리케이션과 해당 MSA를 보호하기 위해 OAuth2가 제공하는 다양한 방법을 설명 



## Cloud 

- 클라우드기반컴퓨팅
  - on-premise : 직접사용
  - IaaS(Infrastructure as a Service) : 인프라사용
  - PaaS(Platform as a Service) : 플랫폼사용
  - SaaS(Software as a Service) : 소프트웨어사용
- 새로운클라우드플랫폼
  - FaaS(Function as a Service) : aws 람다 및 google 클라우드 함수
  - Caas(Container as a Service) : aws ECS



## MSA 

- 사용이유
  - 복잡성 증가
  - 더 빠른 출시
  - 성능 및 확장
  - 애플리케이션을 상시 사용해야 한다



- 특징
  - 적정 크기
  - 위치 투명서
  - 회복성 
  - 반복성
  - 확장성



- 마이크로서비스패턴
  - 핵심 개발 패턴
  - 라우팅 패턴
  - 클라이언트 회복성 패턴
  - 보안 패턴
  - 로깅 및 추적 패턴
  - 빌드 및 배포 패턴



### 핵심개발패턴

- `서비스 세분성`
  - 비즈니즈 영역을 MSA로 분해해서 각각의 MSA가 적정 수준의 책임을 갖게 하는 방법
  - 너무 굵게 나뉘면 시간이 지나면서 의존성이 결함되서 유지보수가 어려워짐
  - 너무 잘게 나뉘면 전반적인 복잡성이 증가
- `통신 프로토콜`
  - json ? xml ? thrift ?
- `인터페이스 설계`
- `서비스 간 이벤트 프로세싱`
  - 서비스간 의존성을 최소화하고 애플리케이션 회복성을 높이기 위해 MSA를 분리



### 라우팅패턴 

- `서비스 디스커버리`
  - 클라이언트 애플리케이션이 서비스 위치를 하드 코딩하지 않고 찾도록 MSA를 어떻게 탐색할까
  - 오작동하는 MSA 인스턴스를 가용 인스턴스 풀에서 어떻게 제거할까
- `서비스 라우팅`
  - 보안 정책과 라우팅 규칙을 MSA의 여러 서비스와 서비스 인스턴스에 차별없이 적용하기 위한 단일 진입점
  - 서비스마다 라우팅을 제공하기 위한 솔루션을 자체적으로 마련할 필요가 없음 



### 회복성패턴

- `클라이언트 측 부하 분산`
  - 여러 인스턴스에 대한 호출이 정상 인스턴스에 분산하도록 서비스 인스턴스 위치를 캐싱
- `회로 차단기 패턴`
  - 클라이언트가 고장나거나 성능 문제가 있는 서비스를 계속 호출하지 않게 하는 방법
  - 서비스가 느리게 실행되면 서비스를 호출하는 클라이언트의 리소스 소모
  - 비정상 MSA 호출이 빨리 실패하면 호출 클라이언트도 신속하게 응답하고 적절한 조치를 취함
- `폴백 패턴`
  - 서비스 호출이 실패시 호출한 MSA가 아닌 다른 대체 수단을 사용
  - 서비스 클라이언트가 작업을 수행할 수 있게 하는 플러그인 메커니즘을 어떻게 제공할까
- `벌크헤드 패턴`
  - MSA는 작업을 수행하기 위해 여러 분산 자원을 사용
  - 오작동하는 서비스 호출 하나가 나머지 애플리케이션에 부정적영향을 미치지 않도록 호출을 구분하는 방법



### 보안패턴

- `인증`
- `인가`
- `자격증명관리와 전파`



### 로깅및추적패턴

- 로그상관관계
- 로그수집
- 마이크로서비스추적



### 빌드및배포패턴

- 빌드 및 배포 파이프라인
- 코드형 인프라스트럭처 
- 불편서버
- 피닉스서버



## 스프링클라우드

### 스프링부트



### 스프링 클라우드 컨피드

- 중앙 집중식 서비스 
- 애플리케이션 구성 데이터 관리 담당
  - 종류
    - Git
    - Consul
    - Eureka



### 스프링 클라우드 서비스 디스커버리

- 서비스를 사용하는 클라이언트에 서버가 배포된 물리적 위치를 추상화
- 서비스 소비자는 물리적 위치보다 논리적 이름을 사용해서 서버의 비즈니스 로직을 호출



### 넷플릭스 히스트릭스와 리본

- 스프링 클라우드는 넥플릭스 히스트릭스 라이브러리와 리본 프로젝트를 포함하여 MSA 안에서 사용하는 일을 간단히 처리
- 넥플릭스 히스트릭스
  - 회로차단기와 벌크헤드와 같은 서비스 클라이언트의 회복성 패턴을 신속히 구현가능
- 넥플릭스 리본 프로젝트 
  - 유레카 같은 서비스 디스커버리 에이전트를 단순하게 통합 
  - 서비스 호출에 대한 클라이언트 측 부하 분산 기능 제공



### 넥플릭스 주울

- 서비스 라우팅 기능 제공
- 주울은 서비스 요청을 대리(proxy)해서 MSA에 대한 모든 호출이 현관문처럼 한곳을 통해 대상 서비스에 도달하게 하는 서비스 게이트웨이
- 보안 인가 및 인증, 콘텐츠 필터링, 라우팅 규칙 등 표준 서비스 정책을 시행가능



### 스프링 클라우드 스트림



### 스프링 클라우드 스루스



### 스프링 클라우드 시큐리디



### 프로버저닝



### 